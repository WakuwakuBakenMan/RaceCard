# ポジションバイアス仕様

## 脚質
- 脚質A：全コーナーを4番手以内で通過した馬
- 脚質B：全コーナーを5番手以降で通過した馬
- 脚質C：その他

## 穴馬
- 人気が4番以上の馬

## 枠順
- 内枠：枠番が1~4
- 外枠：枠番が5~8

## 脚質バイアス
- 各競馬場の当日レース結果を芝／ダートで分けて集計
- 複勝圏、連帯圏、穴好走の3種類
- 複勝圏は3着以内の馬でカウント
- 連帯圏は2着以内の馬でカウント
- 穴好走は3着以内の穴馬でカウント
- 脚質A:B:Cでそれぞれカウントし、A+B+Cの70%以上であれば当該脚質をバイアス発生とする、ただし穴好走は6頭以上サンプルがなければ無効とする
- 脚質Aが70%以上である場合は「先行」と表示し、背景色を強調色に設定する
- 脚質Bが70%以上である場合は「差し」と表示し、背景色を強調色に設定する
- 脚質Cが70%以上である場合は「その他」と表示し、背景色を強調色に設定する
- 70%以上の脚質が無い場合は「フラット」と表示し、背景色をグレーに設定する

## 枠順バイアス
- 各競馬場の当日レース結果を芝／ダートで分けて集計
- 出走頭数14頭以上のレースのみ対象とする
- 芝、ダートそれぞれで対象レースが2レース未満であれば枠順はサンプル不足として算出対象外となる
- 複勝圏、連帯圏、穴好走の3種類
- 複勝圏は3着以内の馬でカウント
- 連帯圏は2着以内の馬でカウント
- 穴好走は3着以内の穴馬でカウント
- 内枠、外枠でそれぞれカウントし、内枠＋外枠の70%以上であれば当該枠順をバイアス発生とする
- 内枠が70%以上である場合は「内枠」と表示し、背景色を強調色に設定する
- 外枠が70%以上である場合は「外枠」と表示し、背景色を強調色に設定する
- 70%以上の枠順が無い場合は「フラット」と表示し、背景色をグレーに設定する

## その他注意事項
- 速報系データを使用するため、当日の集計は SQLite（EveryDB2）を参照する
- データ区分(data_kubun)が6または7となっているレースを対象とする（確定系のみ）
- 新潟芝1000m直はコーナー通過順が取得できない、かつ外枠有利が確定しているため判定の対象外とする

## データ取得ルール（参照テーブル/キー）
- SQLite（EveryDB2）
  - レース情報: N_RACE（Year, MonthDay, JyoCD, Kaiji, Nichiji, RaceNum, TrackCD など）
  - 出馬情報: N_UMA_RACE（Umaban, Wakuban, KettoNum, KakuteiJyuni, Jyuni1c..4c など）
  - オッズ/人気: N_UMA_RACE.Odds/Ninki → 補完に S_ODDS_TANPUKU.TanOdds/TanNinki
  - 払戻（参考）: N_HARAI（単勝=PayTansyo*, 複勝=PayFukusyo*, 馬連=PayUmaren*）
  - 参照キーはゼロ埋め文字列: Year='YYYY', MonthDay='MMDD', JyoCD='JJ', RaceNum='RR'
- PostgreSQL（参考）
  - 各馬の「過去成績」参照には jvd_se（＋必要に応じて nvd_se）を使用するが、ポジションバイアスの判定は当日SQLiteのみで行う
