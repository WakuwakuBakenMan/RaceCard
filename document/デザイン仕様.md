# 出馬表アプリ デザイン仕様

## 目的/範囲
- 本仕様は、当プロジェクト（Astro + React）の出馬表アプリのUI/UX仕様を定義する。
- SPA構成（React Router）で、最新4日分の出馬表データを閲覧するための画面仕様、レイアウト、コンポーネント、ナビゲーション、スタイル指針を示す。

## 技術スタック（UI）
- フロントエンド: Astro + React + TypeScript
- ルーティング: React Router（`BrowserRouter`）
- スタイリング: Tailwind CSS（`src/styles/global.css`でユーティリティと一部カスタム）
- フォント: Google Fonts `Noto Sans JP`
- 配信: GitHub Pages（`astro.config.mjs` の `base` が `/RaceCard`）

## レイアウト/ページ
- ベースレイアウト: `src/layouts/Layout.astro`
  - `<body class="bg-gray-100">` 背景の薄いグレー。
  - Noto Sans JP を全体に適用。
- ルートエントリ: `src/pages/index.astro`
  - `App` コンポーネント（React）を `client:only="react"` でマウント。
  - `BASE_URL` を React Router の `basename` に受け渡し。
- 404: `src/pages/404.astro`
  - SPA直リンク対応のためトップと同じ `App` を描画。

## アプリシェル（`src/App.tsx`）
- コンテナ: `max-w-6xl mx-auto p-4 space-y-6`
  - 画面幅は最大 6xl、中央寄せ、上下左右に適度なパディング。
- ヘッダー:
  - 左上にアプリタイトルリンク（`/`、`text-2xl font-bold`）。
- メイン: React Router で3ルートを提供。
  - `/` → トップ（日付一覧）
  - `/d/:date` → 日付別一覧（会場×レース一覧）
  - `/r/:date/:track/:no` → 出馬表テーブル
- フッター: `text-xs text-gray-500`
  - 文言: 最新4日分のみ／データは `public/data/*.json` を参照。

## 主要画面

### 1) トップ（日付一覧）: `src/components/TopDates.tsx`
- 目的: 最新4日分の対象日へ誘導。
- データ取得: `loadAllDays()` をマウント時に実行。`RaceDay[]` をステートに格納。
- 表示:
  - タイトル: `出馬表（4日分）`（`text-xl font-bold`）
  - 日付ごとのカードリスト（`<li class="border rounded p-3 bg-white">`）
    - 左側: 日付リンク（`/d/[date]`、`text-blue-600 hover:underline text-lg font-semibold`）
    - 右側: 開催別バッジリンク群（`[kaiji]回 [track] [nichiji]日目`）
      - `px-2 py-1 rounded bg-cyan-50 text-cyan-800 hover:bg-cyan-100 border border-cyan-200`
      - ツールチップに `1R〜[races.length]R` を表示。

### 2) 日付別一覧（会場×レースグリッド）: `src/components/DayGrid.tsx`
- 目的: 特定日の各開催のレース一覧から個別レースへ遷移。
- データ取得: `loadDayByDate(date)`。`RaceDay` をステートに格納。
- 上部: 見出し `[date] の出馬表`（`text-xl font-bold`）
- ローディング: `読み込み中…`
- 開催セクション: `section.border.rounded.bg-white`
  - ヘッダーバー: `px-3 py-2 bg-cyan-50 border-b border-cyan-100 font-semibold`
    - 表示: `[kaiji]回 [track] [nichiji]日目`
  - グリッド: `p-3 grid md:grid-cols-4 sm:grid-cols-2 grid-cols-1 gap-3`
    - 各セルはレース1R..maxRを並べる。存在しないRは `opacity-60`、存在するRは `opacity-100`。
    - セルリンク: `/r/[date]/[track]/[R]`、`block rounded border p-2 hover:bg-gray-50`
    - セル内容:
      - 上: `[track] [R]R`（`text-sm text-gray-500`）
      - 中: レース名 or `未設定`（`font-semibold`）
      - 下: `展開カウント: [pace_score] [pace_mark]`（`text-sm text-gray-600`）

### 3) 出馬表テーブル: `src/components/RaceTable.tsx`
- 目的: レース詳細（展開、条件）と馬一覧の閲覧・簡易ソート。
- データ取得: 画面パラメータ `date, track, no` を受け、`loadDayByDate(date)` から対象レース抽出。
- ヘッダーリンク: `← [date] の一覧へ戻る`（`/d/[date]`、`text-sm text-blue-600 hover:underline`）
- レース見出し: `formatRaceHeader({...})` の文字列を `<h1 class="text-lg font-bold">` に表示。
  - 例: `東京 11R／展開カウント 3A／[course_note]／[distance]m・[ground]・[condition]・発走 [start_time]`
- テーブル:
  - 横スクロール可: `overflow-x-auto`
  - `<table class="min-w-full table-sticky border-collapse">`
  - ヘッダは sticky（`global.css` の `.table-sticky thead th`）
  - 列: 馬番、枠、展開型、馬名、性齢、斤量、騎手、調教師、人気、オッズ
  - 並び替え: 人気・オッズ・馬番（クリックで昇順/降順トグル）
  - 行ストライプ: 偶数行 `bg-white`、奇数行 `bg-gray-50 hover:bg-gray-100`
  - 体重/オッズは数値時のみ桁整形（小数1桁表示など）

## コンポーネント/ユーティリティ
- `FrameBadge(draw)`: 枠番バッジ。`frameBgClass(draw)` の色と `draw` 文字を表示。
- `formatRaceHeader(args)`: レース見出し整形。展開カウントや距離・馬場・発走時刻を連結。
- `frameBgClass(draw)`: 枠番に応じて背景色クラスを返す（実装は `src/lib/utils.ts`）。

## ナビゲーション/URL設計
- `/` トップ（4日分の一覧）
- `/d/:date` 日付別一覧
- `/r/:date/:track/:no` 出馬表（個別レース）
- `BASE_URL` を `BrowserRouter basename` に反映。GitHub Pages配信に対応。

## データ取得/キャッシュ方針
- `public/data/date1.json`〜`date4.json` をクライアントから `cache: 'no-store'` で都度取得。
- 404/壊れはスキップ。Dev時は `console.debug`/`console.warn` ログ有り。

## 配色/タイポグラフィ
- 背景: `bg-gray-100`
- カード/セクション: `bg-white`, 枠: `border`, 見出し: `font-bold`
- リンク: 青（`text-blue-600`）+ hover下線
- 開催バッジ: シアン系（`bg-cyan-50`/`text-cyan-800`/`border-cyan-200`）
- フォント: Noto Sans JP、字詰め `font-feature-settings: 'palt' 1`

## レスポンシブ
- 日付グリッド: `grid-cols-1` → `sm:grid-cols-2` → `md:grid-cols-4`
- テーブルは横スクロール許容。

## アクセシビリティ/操作性
- リンク/ボタンに明確なホバー。テーブルヘッダクリックでソート。
- 重要情報（展開カウント、距離・馬場）を見出しで一行要約。

## 既知の非機能要件
- 表示対象は常に最新4日分。
- 静的配信を想定、サーバ不要（データはビルド済みJSON）。
