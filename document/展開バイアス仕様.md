# 展開バイアス仕様

## 展開タイプ
- A:過去3走中2走逃げた馬
- B:過去3走中2走先行した馬
- C:過去3走中1走先行した馬
- 展開タイプAはBまたはCと重複することがある

## 逃げた馬の定義
- 先頭のコーナーを1番手で通過した馬
- または先頭のコーナーを2番手で通過し、次のコーナーを1番手で通過した馬

## 先行した馬の定義
- 全コーナーを4番手以内で通過した馬

## 展開カウント
### 以下の定義で展開カウントを算出する、レース単位でのカウントとする
- 展開タイプC1頭につき+0.5
- 展開タイプB1頭につき+1.0
- 展開タイプAが不在の場合-2.5
- 展開タイプAが2頭以上いる場合+1.5
- 展開タイプBが2頭以下の場合-1.0

## 展開バイアス
- 展開カウントが4.0以下で展開バイアス有と判定
- ただし、展開カウントが最低値(現在の展開カウント定義だと-3.5)の場合は展開バイアスなしとする
- 展開カウントが4.0より大きいときは展開バイアスなしとする

## その他注意事項
- レース開催日は速報系データを使用するためSQLiteから情報を読み込む
- 月曜日以降はPostgreSQLから読み込む
- データ区分(data_kubun)が6または7となっているレースを対象とする
- 新潟芝1000m直はコーナー通過順が取得できないため対象外とする
- 馬の過去成績はPostgreSQLから読み込む

## データ取得ルール
- レース情報・出馬情報: SQLite（EveryDB2）
- 各馬の過去成績（コーナー等）: PostgreSQL（jvd_se＋必要に応じてnvd_se）
- オッズ/人気: SQLite（N_UMA_RACE→S_ODDS_TANPUKUフォールバック）
- エクスポート: SQLiteで日次を生成→PGから過去成績を付与するハイブリッド処理（出力は従来どおり）